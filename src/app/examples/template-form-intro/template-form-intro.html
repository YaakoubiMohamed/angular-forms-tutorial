<div class="container">
  <h2>Formulaires Pilot√©s par Mod√®le - Inscription</h2>

  <p class="description">
    Cet exemple d√©montre les Formulaires Pilot√©s par Mod√®le (approche template-centric).
    La structure du formulaire est d√©finie en HTML avec les directives ngForm et ngModel.
    La validation est sp√©cifi√©e comme attributs HTML.
  </p>

  <!-- Message d'erreur global -->
  @if (submitError) {
    <div class="alert alert-error">
      {{ submitError }}
    </div>
  }

  <!-- Formulaire Principal -->
  <!-- #registrationForm="ngForm" cr√©e une variable de r√©f√©rence de template -->
  <form
    #registrationForm="ngForm"
    (ngSubmit)="onSubmit(registrationForm)"
    class="form"
  >
    
    <!-- Section: Informations Personnelles -->
    <fieldset class="form-section">
      <legend>üë§ Informations Personnelles</legend>

      <!-- Pr√©nom -->
      <div class="form-group">
        <label for="firstName">Pr√©nom:</label>
        <input
          id="firstName"
          type="text"
          name="firstName"
          [(ngModel)]="formData.personalInfo.firstName"
          required
          minlength="2"
          placeholder="Entrez votre pr√©nom"
          class="form-control"
          [class.is-invalid]="submitted && registrationForm.form.get('firstName')?.invalid"
        />
        @if (submitted && registrationForm.form.get('firstName')?.hasError('required')) {
          <div class="error-message">
            {{ getErrorMessage('firstName', 'required') }}
          </div>
        }
        @if (submitted && registrationForm.form.get('firstName')?.hasError('minlength')) {
          <div class="error-message">
            {{ getErrorMessage('firstName', 'minlength') }}
          </div>
        }
      </div>

      <!-- Nom -->
      <div class="form-group">
        <label for="lastName">Nom:</label>
        <input
          id="lastName"
          type="text"
          name="lastName"
          [(ngModel)]="formData.personalInfo.lastName"
          required
          minlength="2"
          placeholder="Entrez votre nom"
          class="form-control"
          [class.is-invalid]="submitted && registrationForm.form.get('lastName')?.invalid"
        />
        @if (submitted && registrationForm.form.get('lastName')?.hasError('required')) {
          <div class="error-message">
            {{ getErrorMessage('lastName', 'required') }}
          </div>
        }
        @if (submitted && registrationForm.form.get('lastName')?.hasError('minlength')) {
          <div class="error-message">
            {{ getErrorMessage('lastName', 'minlength') }}
          </div>
        }
      </div>

      <!-- Date de Naissance -->
      <div class="form-group">
        <label for="birthDate">Date de Naissance:</label>
        <input
          id="birthDate"
          type="date"
          name="birthDate"
          [(ngModel)]="formData.personalInfo.birthDate"
          required
          class="form-control"
          [class.is-invalid]="submitted && registrationForm.form.get('birthDate')?.invalid"
        />
        @if (submitted && registrationForm.form.get('birthDate')?.hasError('required')) {
          <div class="error-message">
            {{ getErrorMessage('birthDate', 'required') }}
          </div>
        }
      </div>
    </fieldset>

    <!-- Section: Informations de Contact -->
    <fieldset class="form-section">
      <legend>üìß Informations de Contact</legend>

      <!-- Email -->
      <div class="form-group">
        <label for="email">Email:</label>
        <input
          id="email"
          type="email"
          name="email"
          [(ngModel)]="formData.contactInfo.email"
          required
          email
          placeholder="Entrez votre email"
          class="form-control"
          [class.is-invalid]="submitted && registrationForm.form.get('email')?.invalid"
        />
        @if (submitted && registrationForm.form.get('email')?.hasError('required')) {
          <div class="error-message">
            {{ getErrorMessage('email', 'required') }}
          </div>
        }
        @if (submitted && registrationForm.form.get('email')?.hasError('email')) {
          <div class="error-message">
            {{ getErrorMessage('email', 'email') }}
          </div>
        }
      </div>

      <!-- T√©l√©phone -->
      <div class="form-group">
        <label for="phone">T√©l√©phone:</label>
        <input
          id="phone"
          type="tel"
          name="phone"
          [(ngModel)]="formData.contactInfo.phone"
          required
          pattern="^\+?[0-9\s\-\(\)]+$"
          placeholder="+33 6 12 34 56 78"
          class="form-control"
          [class.is-invalid]="submitted && registrationForm.form.get('phone')?.invalid"
        />
        @if (submitted && registrationForm.form.get('phone')?.hasError('required')) {
          <div class="error-message">
            {{ getErrorMessage('phone', 'required') }}
          </div>
        }
        @if (submitted && registrationForm.form.get('phone')?.hasError('pattern')) {
          <div class="error-message">
            {{ getErrorMessage('phone', 'pattern') }}
          </div>
        }
      </div>

      <!-- Site Web -->
      <div class="form-group">
        <label for="website">Site Web (optionnel):</label>
        <input
          id="website"
          type="url"
          name="website"
          [(ngModel)]="formData.contactInfo.website"
          pattern="^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$"
          placeholder="https://example.com"
          class="form-control"
          [class.is-invalid]="submitted && registrationForm.form.get('website')?.invalid"
        />
        @if (submitted && registrationForm.form.get('website')?.hasError('pattern')) {
          <div class="error-message">
            {{ getErrorMessage('website', 'pattern') }}
          </div>
        }
      </div>
    </fieldset>

    <!-- Section: Mots de Passe -->
    <fieldset class="form-section">
      <legend>üîê Mots de Passe</legend>

      <!-- Mot de Passe -->
      <div class="form-group">
        <label for="password">Mot de Passe:</label>
        <input
          id="password"
          type="password"
          name="password"
          [(ngModel)]="formData.passwords.password"
          required
          minlength="8"
          placeholder="Minimum 8 caract√®res"
          class="form-control"
          [class.is-invalid]="submitted && registrationForm.form.get('password')?.invalid"
        />
        @if (submitted && registrationForm.form.get('password')?.hasError('required')) {
          <div class="error-message">
            {{ getErrorMessage('password', 'required') }}
          </div>
        }
        @if (submitted && registrationForm.form.get('password')?.hasError('minlength')) {
          <div class="error-message">
            {{ getErrorMessage('password', 'minlength') }}
          </div>
        }
      </div>

      <!-- Confirmer le Mot de Passe -->
      <div class="form-group">
        <label for="confirmPassword">Confirmer le Mot de Passe:</label>
        <input
          id="confirmPassword"
          type="password"
          name="confirmPassword"
          [(ngModel)]="formData.passwords.confirmPassword"
          required
          minlength="8"
          placeholder="Confirmez votre mot de passe"
          class="form-control"
          [class.is-invalid]="submitted && (registrationForm.form.get('confirmPassword')?.invalid || !passwordsMatch())"
        />
        @if (submitted && registrationForm.form.get('confirmPassword')?.hasError('required')) {
          <div class="error-message">
            {{ getErrorMessage('confirmPassword', 'required') }}
          </div>
        }
        @if (submitted && registrationForm.form.get('confirmPassword')?.hasError('minlength')) {
          <div class="error-message">
            {{ getErrorMessage('confirmPassword', 'minlength') }}
          </div>
        }
        @if (submitted && !passwordsMatch()) {
          <div class="error-message group-error">
            ‚ö†Ô∏è Les mots de passe ne correspondent pas
          </div>
        }
      </div>
    </fieldset>

    <!-- Acceptation des Conditions -->
    <div class="form-group checkbox">
      <input
        id="acceptTerms"
        type="checkbox"
        name="acceptTerms"
        [(ngModel)]="formData.acceptTerms"
        required
      />
      <label for="acceptTerms">J'accepte les conditions d'utilisation</label>
      @if (submitted && !formData.acceptTerms) {
        <div class="error-message">
          {{ getErrorMessage('acceptTerms', 'required') }}
        </div>
      }
    </div>

    <!-- Boutons d'Action -->
    <div class="button-group">
      <button
        type="submit"
        [disabled]="registrationForm.invalid && submitted"
        class="btn btn-primary"
      >
        Soumettre l'Inscription
      </button>

      <button
        type="button"
        (click)="resetForm(registrationForm)"
        class="btn btn-secondary"
      >
        R√©initialiser
      </button>

      <button
        type="button"
        (click)="prefillForm()"
        class="btn btn-info"
      >
        Remplir Demo
      </button>
    </div>
  </form>

  <!-- Affichage de l'√âtat du Formulaire -->
  <div class="form-state">
    <h3>üìä √âtat du Formulaire (Suivi Template-Driven)</h3>
    <div class="state-grid">
      <div class="state-item" [class.valid]="registrationForm.valid">
        <strong>Formulaire Valide:</strong> {{ registrationForm.valid }}
      </div>
      <div class="state-item" [class.invalid]="registrationForm.invalid">
        <strong>Formulaire Invalide:</strong> {{ registrationForm.invalid }}
      </div>
      <div class="state-item" [class.dirty]="registrationForm.dirty">
        <strong>Formulaire Modifi√©:</strong> {{ registrationForm.dirty }}
      </div>
      <div class="state-item" [class.pristine]="registrationForm.pristine">
        <strong>Formulaire Vierge:</strong> {{ registrationForm.pristine }}
      </div>
      <div class="state-item" [class.touched]="registrationForm.touched">
        <strong>Formulaire Touch√©:</strong> {{ registrationForm.touched }}
      </div>
      <div class="state-item" [class.untouched]="registrationForm.untouched">
        <strong>Formulaire Non Touch√©:</strong> {{ registrationForm.untouched }}
      </div>
      <div class="state-item">
        <strong>√âtat du Formulaire:</strong> {{ registrationForm.status }}
      </div>
      <div class="state-item">
        <strong>Mots de Passe Correspondants:</strong> {{ passwordsMatch() ? '‚úì' : '‚úó' }}
      </div>
    </div>
  </div>

  <!-- Affichage de la Valeur du Formulaire -->
  <div class="form-value">
    <h3>üìù Valeur Actuelle du Formulaire (Mise √† jour en Temps R√©el)</h3>
    <pre>{{ formData | json }}</pre>
  </div>

  <!-- Affichage des Donn√©es Soumises -->
  @if (submittedData) {
    <div class="submitted-data">
      <h3>‚úÖ Formulaire Soumis avec Succ√®s!</h3>
      <p>Les donn√©es suivantes ont √©t√© soumises:</p>
      <pre>{{ submittedData | json }}</pre>
    </div>
  }

  <!-- Concepts Cl√©s -->
  <div class="concepts">
    <h3>üéì Concepts Cl√©s D√©montr√©s:</h3>
    <ul>
      <li><strong>ngForm:</strong> Directive pour cr√©er un formulaire pilot√© par mod√®le</li>
      <li><strong>ngModel:</strong> Directive pour la liaison bilat√©rale [(ngModel)]</li>
      <li><strong>Validateurs HTML:</strong> required, email, minlength, pattern comme attributs</li>
      <li><strong>√âtat du Formulaire:</strong> valid, dirty, touched, pristine suivi automatiquement</li>
      <li><strong>Groupes Imbriqu√©s:</strong> Grouper les contr√¥les connexes avec ngModelGroup</li>
      <li><strong>Gestion des Erreurs:</strong> Acc√®s aux erreurs via form.get('fieldName')</li>
      <li><strong>Variable de R√©f√©rence:</strong> #registrationForm="ngForm" pour acc√©der √† NgForm</li>
      <li><strong>Liaison Bilat√©rale:</strong> Les changements de template mettent √† jour le mod√®le et vice versa</li>
      <li><strong>Soumission:</strong> Acc√®s aux donn√©es via le mod√®le formData</li>
    </ul>
  </div>

  <!-- Comparaison: R√©actif vs Template-Driven -->
  <div class="comparison">
    <h3>‚öñÔ∏è Comparaison: Formulaires R√©actifs vs Pilot√©s par Mod√®le</h3>
    <div class="comparison-grid">
      <div class="comparison-card">
        <h4>Formulaires R√©actifs</h4>
        <ul>
          <li>‚úì D√©finis en TypeScript</li>
          <li>‚úì Plus de contr√¥le</li>
          <li>‚úì Plus testables</li>
          <li>‚úì FormBuilder, FormGroup, FormArray</li>
          <li>‚úì Meilleur pour les formulaires complexes</li>
          <li>‚úó Plus de boilerplate initial</li>
        </ul>
      </div>
      <div class="comparison-card">
        <h4>Formulaires Pilot√©s par Mod√®le</h4>
        <ul>
          <li>‚úì D√©finis en HTML</li>
          <li>‚úì Syntaxe simple</li>
          <li>‚úì Prototypage rapide</li>
          <li>‚úì ngForm, ngModel, validateurs HTML</li>
          <li>‚úì Meilleur pour les formulaires simples</li>
          <li>‚úó Moins de contr√¥le programmatique</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Avantages des Formulaires Pilot√©s par Mod√®le -->
  <div class="advantages">
    <h3>üí° Avantages des Formulaires Pilot√©s par Mod√®le:</h3>
    <div class="advantage-grid">
      <div class="advantage-card">
        <h4>üéØ Simplicit√©</h4>
        <p>Syntaxe directe et intuitive, peu de boilerplate</p>
      </div>
      <div class="advantage-card">
        <h4>‚ö° Prototypage Rapide</h4>
        <p>Mettre en place rapidement un formulaire simple</p>
      </div>
      <div class="advantage-card">
        <h4>üîÑ Liaison Bilat√©rale</h4>
        <p>Synchronisation automatique entre template et mod√®le</p>
      </div>
      <div class="advantage-card">
        <h4>üì± HTML Familier</h4>
        <p>Utilise les attributs HTML natifs pour la validation</p>
      </div>
    </div>
  </div>
</div>
