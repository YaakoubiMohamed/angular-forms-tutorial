<div class="container">
  <h2>ğŸ“‹ Liste de TÃ¢ches Dynamique avec FormArray</h2>

  <p class="description">
    Cet exemple dÃ©montre FormArray pour gÃ©rer des champs dynamiques: ajouter/supprimer des tÃ¢ches,
    filtrer, trier, et marquer comme complÃ©tÃ©es. Gestion complÃ¨te des listes dynamiques.
  </p>

  <form [formGroup]="todoForm" class="form">
    <!-- ContrÃ´les -->
    <div class="controls">
      <div class="control-group">
        <button type="button" (click)="addTodo()" class="btn btn-success">
          â• Ajouter une TÃ¢che
        </button>
        <button type="button" (click)="completeAll()" class="btn btn-info">
          âœ“ Tout Marquer ComplÃ©tÃ©
        </button>
        <button type="button" (click)="exportData()" class="btn btn-secondary">
          ğŸ’¾ Exporter
        </button>
      </div>

      <!-- Filtres -->
      <div class="filter-group">
        <label>Filtrer:</label>
        <select [(ngModel)]="filterType" [ngModelOptions]="{standalone: true}" class="form-select">
          <option value="all">Tout</option>
          <option value="pending">En Attente</option>
          <option value="completed">ComplÃ©tÃ©es</option>
          <option value="urgent">Urgentes</option>
        </select>

        <label>Trier par:</label>
        <select [(ngModel)]="sortBy" [ngModelOptions]="{standalone: true}" class="form-select">
          <option value="date">Date</option>
          <option value="priority">PrioritÃ©</option>
        </select>

        <button type="button" (click)="resetFilters()" class="btn btn-outline">
          RÃ©initialiser
        </button>
      </div>
    </div>

    <!-- Statistiques -->
    <div class="stats">
      <div class="stat-card">
        <span class="stat-number">{{ getStats().total }}</span>
        <span class="stat-label">Total</span>
      </div>
      <div class="stat-card">
        <span class="stat-number">{{ getStats().completed }}</span>
        <span class="stat-label">ComplÃ©tÃ©es</span>
      </div>
      <div class="stat-card">
        <span class="stat-number">{{ getStats().pending }}</span>
        <span class="stat-label">En Attente</span>
      </div>
      <div class="stat-card">
        <span class="stat-number">{{ getStats().urgent }}</span>
        <span class="stat-label">Urgentes</span>
      </div>
    </div>

    <!-- FormArray de TÃ¢ches -->
    <div class="todos-list">
      @for (todoControl of getFilteredTodos(); let i = $index; track i) {
        <div [formGroup]="todoControl" class="todo-item" [class.completed]="todoControl.get('completed')?.value">
          <!-- Checkbox -->
          <input
            type="checkbox"
            formControlName="completed"
            class="todo-checkbox"
          />

          <!-- Titre -->
          <div class="todo-content">
            <input
              type="text"
              formControlName="title"
              class="todo-title"
              [class.is-invalid]="todoControl.get('title')?.invalid && todoControl.get('title')?.touched"
            />
            @if (todoControl.get('title')?.invalid && todoControl.get('title')?.touched) {
              <div class="error-message">
                {{ getErrorMessage('title') }}
              </div>
            }

            <!-- Description -->
            <textarea
              formControlName="description"
              class="todo-description"
              placeholder="Ajouter une description (optionnel)"
              rows="2"
            ></textarea>
          </div>

          <!-- DÃ©tails -->
          <div class="todo-details">
            <!-- PrioritÃ© -->
            <select
              formControlName="priority"
              class="priority-select"
              [style.border-color]="getPriorityColor(todoControl.get('priority')?.value)"
            >
              <option value="low">Basse</option>
              <option value="medium">Moyenne</option>
              <option value="high">Haute</option>
            </select>

            <!-- Date -->
            <input
              type="date"
              formControlName="dueDate"
              class="form-control"
            />

            <!-- Supprimer -->
            <button type="button" (click)="removeTodo(i)" class="btn btn-danger btn-small">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>

          <!-- PrioritÃ© Badge -->
          <div
            class="priority-badge"
            [style.background-color]="getPriorityColor(todoControl.get('priority')?.value)"
          >
            {{ todoControl.get('priority')?.value }}
          </div>
      } @empty {
        <div class="empty-state">
          <p>ğŸ“­ Aucune tÃ¢che Ã  afficher</p>
          <button type="button" (click)="addTodo()" class="btn btn-success">
            â• CrÃ©er une TÃ¢che
          </button>
        </div>
      }
    </div>
  </form>

  <!-- Concepts -->
  <div class="concepts">
    <h3>ğŸ“ Concepts ClÃ©s (FormArray):</h3>
    <ul>
      <li>âœ“ FormArray pour gÃ©rer des listes dynamiques</li>
      <li>âœ“ Ajouter/supprimer des contrÃ´les dynamiquement</li>
      <li>âœ“ Validation au niveau du champ et du groupe</li>
      <li>âœ“ Filtrage et tri des donnÃ©es</li>
      <li>âœ“ Calcul des statistiques</li>
      <li>âœ“ Ã‰tats visuels (complÃ©tÃ©, urgent)</li>
      <li>âœ“ Gestion des prioritÃ©s avec couleurs</li>
      <li>âœ“ Export des donnÃ©es (JSON)</li>
    </ul>
  </div>
</div>
